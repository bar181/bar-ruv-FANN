Debug and fix the following issues in a distributed task processing system:

The provided code has several critical bugs:
1. Race condition causing duplicate task processing
2. Potential deadlock between worker threads
3. Memory leak in the task queue implementation
4. Incorrect error propagation causing silent failures
5. Task results occasionally being lost or corrupted

Requirements:
1. Fix all identified bugs
2. Ensure thread safety throughout
3. Implement proper cleanup and resource management
4. Add comprehensive error handling
5. Maintain backward compatibility
6. Add unit tests for the fixes