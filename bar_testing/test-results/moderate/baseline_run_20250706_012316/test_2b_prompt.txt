Debug this Python API authentication code:

```python
import hashlib
import time
from typing import Optional

class APIAuthenticator:
    def __init__(self, api_key: str, secret: str):
        self.api_key = api_key
        self.secret = secret
        self._token_cache = {}
    
    def generate_token(self, endpoint: str, params: dict) -> str:
        timestamp = int(time.time())
        
        # Build signature string
        signature_string = f"{self.api_key}{endpoint}"
        for key, value in sorted(params.items()):
            signature_string += f"{key}={value}"
        signature_string += str(timestamp)
        
        # Generate hash
        hash_obj = hashlib.sha256(signature_string.encode())
        hash_obj.update(self.secret.encode())
        
        return hash_obj.hexdigest()
    
    def make_authenticated_request(self, endpoint: str, params: dict):
        token = self.generate_token(endpoint, params)
        
        # Cache token for reuse
        cache_key = f"{endpoint}:{str(sorted(params.items()))}"
        self._token_cache[cache_key] = {
            'token': token,
            'timestamp': time.time()
        }
        
        headers = {
            'X-API-Key': self.api_key,
            'X-Auth-Token': token,
            'X-Timestamp': str(int(time.time()))
        }
        
        return headers

# Usage
auth = APIAuthenticator("test_key", "test_secret")
headers1 = auth.make_authenticated_request("/api/users", {"id": 123})
time.sleep(1)
headers2 = auth.make_authenticated_request("/api/users", {"id": 123})

print(f"Token 1: {headers1['X-Auth-Token']}")
print(f"Token 2: {headers2['X-Auth-Token']}")
print(f"Tokens match: {headers1['X-Auth-Token'] == headers2['X-Auth-Token']}")
```

The authentication is failing on the server. The server expects:
1. Consistent tokens for same requests within 5-minute window
2. Timestamp in signature must match X-Timestamp header
3. SHA256 signature format: sha256(api_key + endpoint + sorted_params + timestamp + secret)

Find and fix ALL bugs. Explain what was wrong and provide corrected code.
